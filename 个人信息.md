# 密码定向攻击模块

## 代码功能描述
### 1.项目目标
实现Targeted Online Password Guessing：An Underestimated Threat论文中的两种定向猜测算法TARGUESS I、Ⅱ，完成密码库的训练学习功能和定向猜测密码生成功能。

### 2.可维护性需求
1. 训练集和模型的格式设计需要保证便于添加新的个人信息的支持。
1. 定向攻击猜测模型训练模块需要保证在训练集中引入新的个人信息字段时，能够方便的修改训练相关的代码。
1. 定向攻击猜测密码生成模块需要保证在模型中引入新的个人信息结构时，能够方便的修改密码生成相关的代码。
1. 代码需要提供必要的注释。

定向攻击猜测模型训练模块和定向攻击猜测密码生成模块需要提供相应的测试数据。

### 3.相关模块及代码
#### （1）项目主要代码：
- targuess1_train

功能：该模块用于对targuess I算法模型进行训练，并按照要求读取并解析配置文件，然后根据读取的参数进行训练并输出模型文件和log文件。

训练过程：加入了个人信息的PCFG的训练过程。首先读取用户的个人信息和口令后，使用用户个人信息的变换在口令中进行匹配，然后得到该口令的pattern。然后按照PCFG的方法进行排序，最后把各个pattern和各类型的字符串以及相应的概率输出到模型文件中。训练集格式为：邮箱名\t口令\t姓名拼音（用|隔开）\t身份证号\t用户名\t手机号\t生日。若该个人信息缺失，则用空串代替。

具体代码文件：

    a. targuess1_train.cpp：模块主代码，输入为用户的个人信息和口令，输出模型文件。
    b. person.h和person.cpp：把个人信息相关的变量和相关的函数封装起来。
- targuess1_guess

功能：该模块根据targuess I的训练模块的模型文件，根据用户个人信息生成密码，并按照要求读取并解析配置文件，然后根据读取的参数输出生成密码文件和log文件。

生成过程：首先配置文件和模型文件中读取模块的参数以及训练模型的参数。然后读取用户的个人信息，对于每个用户，分别对每个PCFG生成的preguess进行个人信息的填充，然后输出，直到满足约束条件。

具体文件：

    a.targuess1_guess.cpp：模块主代码，输入配置文件与targuess1_train生成的模型文件，按要求输出密码文件和log文件。个人信息文件的格式跟训练集相同。
    b.personTran.h和personTran.cpp：该类的作用是把个人信息的变形封装起来。
- targuess2_train

功能：该模块用于对targuess II算法模型进行训练，并按照要求读取并解析配置文件，然后根据读取的参数进行训练并输出模型文件和log文件。

训练过程：首先读取用户新旧口令对，然后算法对相似的口令对进行分析，通过编辑矩阵分析从旧口令在结构级和字段级变换到新口令的过程，然后把相应的概率保存下来，经过平滑处理后输出到模型文件中。训练集格式为：邮箱名\t旧口令\t新口令\t相似度（可以忽略，只是方便看），程序中只用到了前三个数据。

具体代码文件：

    a. targuess2_train.cpp：模块主代码，输入为用户的个人信息和口令，输出模型文件。在main函数中，读入两个口令后，先调用isScience函数判断是否是科学计数法，若某一个口令是则直接跳过分析过程。然后如果两个口令的相似度小于0.5则调用analyse函数分析两个口令变换的过程。最后把分析过程中得到的数据输出到模型文件中。
    b. person.h和person.cpp：把个人信息相关的变量和相关的函数封装起来。
        - 该类包括几个个人信息的变量：string email, name, birth, account, phone, psw, gid：
        - 以及相关的函数：
            void findStr(string& pat_str, string psw, string str, char c)：该函数传入的参数为口令的pattern字符串pat_str，口令psw，需要查找的个人信息的变换str以及替换的label c。该函数的功能是在psw中查找str，若成功，则在pat_str中相应的位置替换成label c。
- targuess2_guess

功能：根据targuess2的训练模块的模型文件，根据用户的sispsw生成密码，并按照要求读取并解析配置文件，然后根据读取的参数输出生成密码文件和log文件

生成流程：首先从配置文件和模型文件中读取模块的参数以及训练模型的参数。然后读取上面预先得到的PCFG结构信息、markov字段信息以及top口令的信息。最后读取用户的sispsw信息，对这个sispsw进行结构级变换以及字段级变换，插入到优先队列中。对优先队列概率最大的guess重复上述步骤。

组成文件：

    targuess2_guess.cpp：主代码，读入模型文件与参数，生成密码文件与log。辅助程序有三个，调用方法跟其他相同，也是通过读取配置文件读入参数。
        - 结构体
            Guess结构体用于保存生成的guess，并插入到优先队列中。
            next_pro结构体用于保存markov得到的前缀后面接字符的概率。
#### （2）辅助代码：
- targuess2_genPCFGdata

功能：该程序的作用是使用别的口令集，通过PCFG的方法得到D、L、S三种类型字符串在长度为1-10出现次数最多的若干个字符串以及相应的概率，用于targuess2_guess中进行结构级变换时增加的结构。

配置文件格式如下：

    [basic_config]
    training_set_path=F:/psw_dataset/rockyou.txt
    model_output_path=rockyou_PCFG_data.txt
    max_output_num=10`
其中

    training_set_path为口令集的路径，该口令集可以是任意的口令集，格式为一行一个口令。
    model_output_path为得到的数据输出路径。
    max_output_num为输出每种结构（如D3）出现次数前max_output_num的字符串及概率。
- targuess2_genMarkovdata

功能：使用别的口令集，利用markov的方法，得到各个同种类型的前缀（如：全是数字或全是字母）后面接相同类型字符的概率，如：123后面接0-9的概率。用于targuess2_guess中进行内部变换即相同类型的字段中进行尾部增加的字符及相应的概率。

配置文件格式如下：

    [basic_config]
    training_set_path=F:/psw_dataset/yahoo.txt
    output_path=yahoo_markov_reverse_data.txt
    order=3
    is_reverse=true
其中

    training_set_path为口令集的路径，该口令集可以是任意的口令集，格式为一行一个口令。
    output_path为数据输出的路径
    order为markov考虑的前缀长度，如order=3表示考虑长度为三的前缀后面接同类型字符的概率
    is_reverse为是否把字符串颠倒再进行统计。这里把字符串颠倒进行统计等价于各后缀前面接同类型字符的概率。用于targuess2_guess中进行内部变换中进行首部增加字符及概率。
- targuess2_genToppsw

功能：使用从一个或多个口令集统计出的top口令，在一个口令重用匹配的目标口令集（数量尽量多点，不然top口令覆盖率太低）中统计并计算出相应的概率，用于在生成guess的时候插入到优先队列中，与用sispsw生成的guess一起进行排序。

配置文件格式如下：

    [basic_config]
    top_input_path=top.txt
    training_set_path=csdn_126_reuse.txt
    output_path=top_pro.txt
    smooth=0.1
其中

    top_input_path为top口令文件的路径，格式为一行一个口令（该文件可以自己统计，这里就不提供代码了）
    training_set_path为targuess2_guess的训练集
    output_path为输出文件路径
    smooth为平滑参数，默认为0.1
#### （3）公共模块接口
- read_config.h

功能：该文件包括一个函数，用于读取config中的内容并进行解析；config文件需用等号隔开，等号前面为参数名，等号后面为参数的值，然后把参数名和值存入map中传递。注意，该函数只对等号缺失进行了错误判断，请确保config文件格式无误，请勿在config文件中加注释。

参数：

    string path：config文件的路径。
    map<string, string> & rtn：用于存放解析后的参数名和值的容器。
- time.h和time.cpp：time.h

功能：定义了CTimer类的变量及函数，time.cpp实现了time.h所定义的函数。该类负责创建一个线程进行计时，实现定时向log文件打印摘要信息的功能。
## 相关科研项目、论文
主要根据北京大学汪定为第一作者的《Targeted Online Password Guessing：An Underestimated Threat》论文中的两种定向猜测算法TARGUESS I、Ⅱ完成。


## 实验设计
该代码如果是为特定实验所写，注明相应的实验设计，包括数据集、参数设置等。

## 环境
定向攻击模块的所有开发、改动，要求遵循以下约束。

1. 系统需运行在Windows平台上，部署平台有Windows 7 ultimate 64位版本、Windows Server 2008 R2 64位版本、Windows 10 64位;

定向攻击模块的功能、破解效果和性能测试数据明确为如下：

    数据集	数量	字段	备注
    - 12306 129303 姓名、生日、电话号码、身份证号、用户名、邮箱、密码 TARGUESS Ⅰ训练集
    - dodonew 49775	姓名、生日、电话号码、身份证号、用户名、邮箱、密码 TARGUESS Ⅰ测试集，通过邮箱与12306关联，补全dodonew中缺失的个人信息
    - 12306、dodonew姊妹密码对 49775 用户在12306和dodonew中的姊妹密码 TARGUESS Ⅱ训练集，通过邮箱关联12306和dodonew 中的姊妹密码
    - 12306、csdn姊妹密码对 12635 用户在12306和csdn中的姊妹密码 TARGUESS Ⅱ测试集，通过邮箱关联12306和csdn中的姊妹密码

2. 当前系统的实现环境

（1）.开发环境：

操作系统：Windows 7及更高版本的64位操作系统

语言：c++、c、python3

IDE: mingw +eclipse+cdt

（2）.运行环境

硬件：CPU  Intel E5-2620/64G RAM/SATA 1000G HD/GE网卡/GTX1080*4。

软件环境：Windows 7及更高版本的64位操作系统。


## 代码实现的关键算法
例如PCFG模型、Markov模型，概率表的数据结构以及相应的存取算法。

## Q & A
问题及解答

在交接过程中的疑问和回答，如果不方便放到其他条目，可以以问答的形式放在这。

## 其他改进的方向、思路
可以描述已经尝试但失败的改进方法、未尝试但有希望的的改进方法等。
