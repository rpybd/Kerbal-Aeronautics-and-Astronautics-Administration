# 密码定向攻击模块

## 代码功能描述
### 1.项目目标
实现Targeted Online Password Guessing：An Underestimated Threat论文中的两种定向猜测算法TARGUESS I、Ⅱ，完成密码库的训练学习功能和定向猜测密码生成功能。

### 2.可维护性需求
1. 训练集和模型的格式设计需要保证便于添加新的个人信息的支持。
1. 定向攻击猜测模型训练模块需要保证在训练集中引入新的个人信息字段时，能够方便的修改训练相关的代码。
1. 定向攻击猜测密码生成模块需要保证在模型中引入新的个人信息结构时，能够方便的修改密码生成相关的代码。
1. 代码需要提供必要的注释。

定向攻击猜测模型训练模块和定向攻击猜测密码生成模块需要提供相应的测试数据。

### 3.相关代码
#### （1）项目主要代码：
- targuess1_train

功能：该模块用于对targuess I算法模型进行训练，并按照要求读取并解析配置文件，然后根据读取的参数进行训练并输出模型文件和log文件。

训练过程：加入了个人信息的PCFG的训练过程。首先读取用户的个人信息和口令后，使用用户个人信息的变换在口令中进行匹配，然后得到该口令的pattern。然后按照PCFG的方法进行排序，最后把各个pattern和各类型的字符串以及相应的概率输出到模型文件中。训练集格式为：邮箱名\t口令\t姓名拼音（用|隔开）\t身份证号\t用户名\t手机号\t生日。若该个人信息缺失，则用空串代替。

具体代码文件：

    a. targuess1_train.cpp：模块主代码，主要包含三个函数：
        string getPattern(string email, string psw)：该函数传入的参数是用户的邮箱和口令，实现了根据个人信息获取口令的pattern；
        void addDLSPattern(string psw, string pat_str)：该函数传入的参数是psw和pattern字符串pat_str，功能是把psw中的DLS段插入到map中进行计数；
        void sortTable()：该函数实现了对统计后的DLS段根据概率进行排序，具体来说就是前面统计的时候是根据字典序进行排序的，现在以概率作为key插入到各个类型map中，以此来实现排序。

    b. person.h和person.cpp：把个人信息相关的变量和相关的函数封装起来。
        - 该类包括几个个人信息的变量：string email, name, birth, account, phone, psw, gid：
        - 以及相关的函数：
            void findStr(string& pat_str, string psw, string str, char c)：该函数传入的参数为口令的pattern字符串pat_str，口令psw，需要查找的个人信息的变换str以及替换的label c。该函数的功能是在psw中查找str，若成功，则在pat_str中相应的位置替换成label c。
            void processPhone(string& pat_str, string psw)：该函数传入的参数是pattern字符串pat_str和口令psw，函数调用上面的findStr函数，在用户的口令中查找变量phone，然后替换成label C。
            void processName(string& pat_str, string psw)：该函数传入的参数与上面相同，函数对姓名信息name进行变形，然后调用findStr函数对pattern字符串匹配的name信息替换成相应的标签。
            void processBirth(string& pat_str, string psw)：该函数传入的参数与上面相同，函数对生日信息birth进行变形，然后调用findStr函数对pattern字符串匹配的birth信息替换成相应的标签。
            void processEmail(string& pat_str, string psw)：该函数传入的参数与上面相同，函数对邮箱信息email进行变形，然后调用findStr函数对pattern字符串匹配的email信息替换成相应的标签。
            void processAccount(string& pat_str, string psw)：该函数传入的参数与上面相同，函数对用户名信息account进行变形，然后调用findStr函数对pattern字符串匹配的account信息替换成相应的标签。
            void processGid(string& pat_str, string psw)：该函数传入的参数与上面相同，函数对身份证信息gid进行变形，然后调用findStr函数对pattern字符串匹配的account信息替换成相应的标签。

- targuess1_guess
- targuess2_train
- targuess2_guess
#### （2）辅助代码：
- targuess2_genPCFGdata
- targuess2_genMarkovdata
- targuess2_genToppsw
#### （3）公共模块接口
- read_config.h

功能：该文件包括一个函数，用于读取config中的内容并进行解析；config文件需用等号隔开，等号前面为参数名，等号后面为参数的值，然后把参数名和值存入map中传递。注意，该函数只对等号缺失进行了错误判断，请确保config文件格式无误，请勿在config文件中加注释。

参数：

    string path：config文件的路径。
    map<string, string> & rtn：用于存放解析后的参数名和值的容器。
- time.h和time.cpp：time.h

功能：定义了CTimer类的变量及函数，time.cpp实现了time.h所定义的函数。该类负责创建一个线程进行计时，实现定时向log文件打印摘要信息的功能。

参数：该类包括几个函数和固定的变量：

    CTimer()：CTimer类的构造函数，初始化打印间隔m_Elapse和线程m_hThread。
    ~CTimer()：CTimer类的析构函数，负责结束线程并打印结束的log信息。
    static time_t start_time：该变量为线程开始计时的时间，线程创建时获取系统当前时间。
    static float time_cost：该变量为线程计时消耗的时间，单位为秒。
    static string status：该变量为当前模块的状态，有running，sorting，predicting，finish等状态。
    void StartTimer(float nElapse): 传入参数为打印log的时间间隔，该函数的作用是设置打印时间间隔并创建计时线程开始计时，然后初始化start_time。
    void EndTimer()：该函数的作用是关闭计时线程。
    static DWORD WINAPI ThreadFunc(LPVOID pParam)：该函数是计时线程运行时执行的函数，使用一个while循环判断时间间隔是否满足条件，若满足则打印所需的log摘要信息。
    float m_Elapse：该变量为log打印的时间间隔，单位为秒。
    HANDLE m_hThread：该变量为计时线程。

- 
- 

详细描述代码的功能，并详细描述代码所需参数以及输入输出（包括格式要求）。
例如，蒙特卡洛算法：通过蒙特卡洛方法抽样计算给定口令的猜测次数，默认抽样个数为1000。输入为口令（长度1到30的字符串），输出为猜测次数（非负浮点数，该猜测次数为估计值，故可能不是整数）。

此处只需描述代码提供的外部接口，内部函数的描述可以以注释的形式写在代码中。

## 相关科研项目、论文
大致描述该代码的相关的项目或论文情况。

如果是现有研究论文的重现，说明原始论文的题目，最好附上原始论文实验的复现结果。

如果是实验室已发表论文的实验代码，指出对应论文的实验部分（包括图表的序号）。

如果是其他尚未形成论文、或论文尚未公开的代码，大致描述相关研究的动机、目标、内容等。

## 实验设计
该代码如果是为特定实验所写，注明相应的实验设计，包括数据集、参数设置等。

## 环境
编程语言、版本等，包括其他运行代码所需注意的事项。

如有必要，详细描述环境配置过程。

## 代码实现的关键算法
例如PCFG模型、Markov模型，概率表的数据结构以及相应的存取算法。

## Q & A
问题及解答

在交接过程中的疑问和回答，如果不方便放到其他条目，可以以问答的形式放在这。

## 其他改进的方向、思路
可以描述已经尝试但失败的改进方法、未尝试但有希望的的改进方法等。
